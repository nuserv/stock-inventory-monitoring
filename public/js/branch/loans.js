var table,requesttable,interval=null;$(document).ready(function(){table=$("table.loanTable").DataTable({dom:"rt",processing:!0,serverSide:!0,language:{emptyTable:" "},ajax:{url:"loanstable",error:function(a,d,c){401==a.status&&(window.location.href="/login")}},columns:[{data:"date",name:"date"},{data:"branch",name:"branch"},{data:"item",name:"item"},{data:"stat",name:"stat"},{data:"status",name:"status"}]})});
$(document).on("click","#loanTable tr",function(){var a=table.row(this).data(),d=a.id,c=a.branchid,b=" ",e=a.item;e=e.replace(/&quot;/g,'"');$("#date").val(a.date);$("#description").val(e);$("#status").val(a.status);$("#myid").val(a.id);$("#branch_id").val(a.branchid);$("#branch").val(a.branch);"IN-BOUND"==a.stat?($("#serials").hide(),$("#received_Btn").hide(),$("#del_Btn").hide(),$.ajax({type:"get",url:"loanitemcode",data:{id:a.items_id},success:function(f){b+='<option selected value="select" disabled>select description</option>';
for(var g=0;g<f.length;g++)b+='<option value="'+f[g].id+'">'+f[g].item.toUpperCase()+"</option>";$("#loandesc1").find("option").remove().end().append(b)},error:function(f,g,h){alert(f.responseText)}}),"pending"!=a.status?($("#submit_Btn").hide(),$("#loanrow1").hide()):($("#submit_Btn").show(),$("#loanrow1").show())):($("#submit_Btn").hide(),$("#loanrow1").hide(),"approved"==a.status?($("#received_Btn").show(),$("#serials").show(),$("#del_Btn").hide(),$.ajax({url:"loanget",dataType:"json",type:"GET",
async:!1,data:{id:d,branch:c},success:function(f){$("#serial").val(f.serial)},error:function(f,g,h){alert(f.responseText)}})):($("#received_Btn").hide(),$("#serials").hide(),$("#del_Btn").show()));$("#loansModal").modal({backdrop:"static",keyboard:!1})});
$(document).on("click","#submit_Btn",function(){var a=$("#myid").val(),d=$("#loanserial1").val(),c=$("#branch_id").val();$("#loanserial1").val()&&"pending"==$("#status").val()&&($.ajax({url:"loanstock",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,item:d,branch:c},error:function(b,e,f){alert(b.responseText)}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,
status:"approved"},success:function(b){table.draw();$("#loansModal .close").click()},error:function(b,e,f){alert(b.responseText)}}))});
$(document).on("click","#received_Btn",function(){var a=$("#myid").val(),d=$("#branch_id").val();$("#serial").val()&&"approved"==$("#status").val()&&($.ajax({url:"loanupdate",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,branch:d},error:function(c,b,e){alert(c.responseText)}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,status:"completed"},success:function(c){table.draw();
$("#loansModal .close").click()},error:function(c,b,e){alert(c.responseText)}}))});$(document).on("click","#del_Btn",function(){var a=$("#myid").val();$("#branch_id").val();$.ajax({url:"loandelete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,status:"deleted"},success:function(d){table.draw();$("#loansModal .close").click()},error:function(d,c,b){alert(d.responseText)}})});
$(document).on("change","#loandesc1",function(){var a=$(this).val(),d=" ";$.ajax({type:"get",url:"getserials",data:{id:a},async:!1,success:function(c){d+='<option selected value="select" disabled>select serial</option>';for(var b=0;b<c.length;b++)d+='<option value="'+c[b].id+'">'+c[b].serial+"</option>";$("#loanserial1").find("option").remove().end().append(d)},error:function(c,b,e){alert(c.responseText)}})});$(document).on("click",".cancel",function(){window.location.href="loans"});
$(document).on("change","#loanbranch",function(){var a=$(this).val(),d=" ";$.ajax({type:"get",url:"bcategory",data:{id:a},success:function(c){d+='<option selected value="select" disabled>select category</option>';for(var b=0;b<c.length;b++)d+='<option value="'+c[b].category_id+'">'+c[b].category.toUpperCase()+"</option>";$("#loanreqcategory1").find("option").remove().end().append(d);$("#loanreqdesc1").find("option").remove().end().append('<option selected value="select" disabled>select description</option>')},
error:function(c,b,e){alert(c.responseText)}})});$(document).on("change","#loanreqcategory1",function(){var a=$(this).val(),d=$("#loanbranch").val(),c=" ";$.ajax({type:"get",url:"bitem",data:{catid:a,branchid:d},success:function(b){c+='<option selected value="select" disabled>select description</option>';for(var e=0;e<b.length;e++)c+='<option value="'+b[e].items_id+'">'+b[e].item.toUpperCase()+"</option>";$("#loanreqdesc1").find("option").remove().end().append(c)},error:function(b,e,f){alert(b.responseText)}})});
$(document).on("click","#serial_sub_Btn",function(){if($("#loanreqdesc1").val()){var a=$("#loanbranch").val(),d=$("#loanreqdesc1").val();$.ajax({url:"loan",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"POST",data:{branchid:a,itemid:d},success:function(c){window.location.href="loans"},error:function(c,b,e){alert(c.responseText)}})}});$(document).on("click","#loan_Btn",function(){$("#loanModal").modal({backdrop:"static",keyboard:!1})});