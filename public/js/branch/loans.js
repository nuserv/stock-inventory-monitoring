var table,requesttable,interval=null;$(document).ready(function(){table=$("table.loanTable").DataTable({dom:"rt",processing:!0,serverSide:!0,language:{emptyTable:" "},ajax:"loanstable",columns:[{data:"date",name:"date"},{data:"branch",name:"branch"},{data:"item",name:"item"},{data:"stat",name:"stat"},{data:"status",name:"status"}]});interval=setInterval(function(){table.draw()},3E4)});
$(document).on("click","#loanTable tr",function(){clearInterval(interval);var b=table.row(this).data(),d=b.id,c=b.branchid,a=" ",e=b.item;e=e.replace(/&quot;/g,'"');$("#date").val(b.date);$("#description").val(e);$("#status").val(b.status);$("#myid").val(b.id);$("#branch_id").val(b.branchid);$("#branch").val(b.branch);"IN-BOUND"==b.stat?($("#serials").hide(),$("#received_Btn").hide(),$("#del_Btn").hide(),$.ajax({type:"get",url:"loanitemcode",data:{id:b.items_id},success:function(f){a+='<option selected value="select" disabled>select description</option>';
for(var g=0;g<f.length;g++)a+='<option value="'+f[g].id+'">'+f[g].item.toUpperCase()+"</option>";$("#loandesc1").find("option").remove().end().append(a)},error:function(f,g,h){alert(f.responseText)}}),"pending"!=b.status?($("#submit_Btn").hide(),$("#loanrow1").hide()):($("#submit_Btn").show(),$("#loanrow1").show())):($("#submit_Btn").hide(),$("#loanrow1").hide(),"approved"==b.status?($("#received_Btn").show(),$("#serials").show(),$("#del_Btn").hide(),$.ajax({url:"loanget",dataType:"json",type:"GET",
async:!1,data:{id:d,branch:c},success:function(f){$("#serial").val(f.serial)},error:function(f,g,h){alert(f.responseText)}})):($("#received_Btn").hide(),$("#serials").hide(),$("#del_Btn").show()));$("#loansModal").modal({backdrop:"static",keyboard:!1})});
$(document).on("click","#submit_Btn",function(){var b=$("#myid").val(),d=$("#loanserial1").val(),c=$("#branch_id").val();$("#loanserial1").val()&&"pending"==$("#status").val()&&($.ajax({url:"loanstock",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:b,item:d,branch:c},error:function(a,e,f){alert(a.responseText)}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:b,
status:"approved"},success:function(a){interval=setInterval(function(){table.draw()},3E4);table.draw();$("#loansModal .close").click()},error:function(a,e,f){alert(a.responseText)}}))});
$(document).on("click","#received_Btn",function(){var b=$("#myid").val(),d=$("#branch_id").val();$("#serial").val()&&"approved"==$("#status").val()&&($.ajax({url:"loanupdate",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:b,branch:d},error:function(c,a,e){alert(c.responseText)}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:b,status:"completed"},success:function(c){interval=
setInterval(function(){table.draw()},3E4);table.draw();$("#loansModal .close").click()},error:function(c,a,e){alert(c.responseText)}}))});
$(document).on("click","#del_Btn",function(){var b=$("#myid").val();$("#branch_id").val();$.ajax({url:"loandelete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:b,status:"deleted"},success:function(d){interval=setInterval(function(){table.draw()},3E4);table.draw();$("#loansModal .close").click()},error:function(d,c,a){alert(d.responseText)}})});
$(document).on("change","#loandesc1",function(){var b=$(this).val(),d=" ";$.ajax({type:"get",url:"getserials",data:{id:b},async:!1,success:function(c){d+='<option selected value="select" disabled>select serial</option>';for(var a=0;a<c.length;a++)d+='<option value="'+c[a].id+'">'+c[a].serial+"</option>";$("#loanserial1").find("option").remove().end().append(d)},error:function(c,a,e){alert(c.responseText)}})});$(document).on("click",".cancel",function(){window.location.href="loans"});
$(document).on("change","#loanbranch",function(){var b=$(this).val(),d=" ";$.ajax({type:"get",url:"bcategory",data:{id:b},success:function(c){d+='<option selected value="select" disabled>select category</option>';for(var a=0;a<c.length;a++)d+='<option value="'+c[a].category_id+'">'+c[a].category.toUpperCase()+"</option>";$("#loanreqcategory1").find("option").remove().end().append(d);$("#loanreqdesc1").find("option").remove().end().append('<option selected value="select" disabled>select description</option>')},
error:function(c,a,e){alert(c.responseText)}})});$(document).on("change","#loanreqcategory1",function(){var b=$(this).val(),d=$("#loanbranch").val(),c=" ";$.ajax({type:"get",url:"bitem",data:{catid:b,branchid:d},success:function(a){c+='<option selected value="select" disabled>select description</option>';for(var e=0;e<a.length;e++)c+='<option value="'+a[e].items_id+'">'+a[e].item.toUpperCase()+"</option>";$("#loanreqdesc1").find("option").remove().end().append(c)},error:function(a,e,f){alert(a.responseText)}})});
$(document).on("click","#serial_sub_Btn",function(){if($("#loanreqdesc1").val()){var b=$("#loanbranch").val(),d=$("#loanreqdesc1").val();$.ajax({url:"loan",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"POST",data:{branchid:b,itemid:d},success:function(c){window.location.href="loans"},error:function(c,a,e){alert(c.responseText)}})}});$(document).on("click","#loan_Btn",function(){clearInterval(interval);$("#loanModal").modal({backdrop:"static",keyboard:!1})});