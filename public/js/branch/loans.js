var table,requesttable,interval=null;$(document).ready(function(){table=$("table.loanTable").DataTable({dom:"rt",processing:!0,serverSide:!0,language:{emptyTable:" "},ajax:"loanstable",columns:[{data:"date",name:"date"},{data:"branch",name:"branch"},{data:"item",name:"item"},{data:"stat",name:"stat"},{data:"status",name:"status"}]});interval=setInterval(function(){table.draw()},3E4)});
$(document).on("click","#loanTable tr",function(){clearInterval(interval);var a=table.row(this).data(),c=a.id,d=a.branchid,b=" ";$("#date").val(a.date);$("#description").val(a.item);$("#status").val(a.status);$("#myid").val(a.id);$("#branch_id").val(a.branchid);$("#branch").val(a.branch);"IN-BOUND"==a.stat?($("#serials").hide(),$("#received_Btn").hide(),$("#del_Btn").hide(),$.ajax({type:"get",url:"loanitemcode",data:{id:a.items_id},success:function(e){b+='<option selected value="select" disabled>select description</option>';
for(var f=0;f<e.length;f++)b+='<option value="'+e[f].id+'">'+e[f].item.toUpperCase()+"</option>";$("#loandesc1").find("option").remove().end().append(b)}}),"pending"!=a.status?($("#submit_Btn").hide(),$("#loanrow1").hide()):($("#submit_Btn").show(),$("#loanrow1").show())):($("#submit_Btn").hide(),$("#loanrow1").hide(),"approved"==a.status?($("#received_Btn").show(),$("#serials").show(),$("#del_Btn").hide(),$.ajax({url:"loanget",dataType:"json",type:"GET",async:!1,data:{id:c,branch:d},success:function(e){$("#serial").val(e.serial)}})):
($("#received_Btn").hide(),$("#serials").hide(),$("#del_Btn").show()));$("#loansModal").modal({backdrop:"static",keyboard:!1})});
$(document).on("click","#submit_Btn",function(){var a=$("#myid").val(),c=$("#loanserial1").val(),d=$("#branch_id").val();$("#loanserial1").val()&&"pending"==$("#status").val()&&($.ajax({url:"loanstock",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,item:c,branch:d}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,status:"approved"},success:function(b){window.location.href=
"loans"}}))});
$(document).on("click","#received_Btn",function(){var a=$("#myid").val(),c=$("#branch_id").val();$("#serial").val()&&"approved"==$("#status").val()&&($.ajax({url:"loanupdate",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,branch:c}}),$.ajax({url:"loansapproved",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,status:"completed"},success:function(d){window.location.href="loans"}}))});
$(document).on("click","#del_Btn",function(){var a=$("#myid").val();$("#branch_id").val();$.ajax({url:"loandelete",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"PUT",data:{id:a,status:"deleted"}});window.location.href="loans"});
$(document).on("change","#loandesc1",function(){var a=$(this).val(),c=" ";$.ajax({type:"get",url:"getserials",data:{id:a},async:!1,success:function(d){c+='<option selected value="select" disabled>select serial</option>';for(var b=0;b<d.length;b++)c+='<option value="'+d[b].id+'">'+d[b].serial+"</option>";$("#loanserial1").find("option").remove().end().append(c)}})});$(document).on("click",".cancel",function(){window.location.href="loans"});
$(document).on("change","#loanbranch",function(){var a=$(this).val(),c=" ";$.ajax({type:"get",url:"bcategory",data:{id:a},success:function(d){console.log(d);c+='<option selected value="select" disabled>select category</option>';for(var b=0;b<d.length;b++)c+='<option value="'+d[b].category_id+'">'+d[b].category.toUpperCase()+"</option>";$("#loanreqcategory1").find("option").remove().end().append(c);$("#loanreqdesc1").find("option").remove().end().append('<option selected value="select" disabled>select description</option>')}})});
$(document).on("change","#loanreqcategory1",function(){var a=$(this).val(),c=$("#loanbranch").val(),d=" ";$.ajax({type:"get",url:"bitem",data:{catid:a,branchid:c},success:function(b){console.log(b);d+='<option selected value="select" disabled>select description</option>';for(var e=0;e<b.length;e++)d+='<option value="'+b[e].items_id+'">'+b[e].item.toUpperCase()+"</option>";console.log(b[0].items_id);$("#loanreqdesc1").find("option").remove().end().append(d)}})});
$(document).on("click","#serial_sub_Btn",function(){if($("#loanreqdesc1").val()){var a=$("#loanbranch").val(),c=$("#loanreqdesc1").val();$.ajax({url:"loan",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",type:"POST",data:{branchid:a,itemid:c}});window.location.href="loans"}});$(document).on("click","#loan_Btn",function(){clearInterval(interval);$("#loanModal").modal({backdrop:"static",keyboard:!1})});